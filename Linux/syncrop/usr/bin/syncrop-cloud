#!/bin/bash
command=$1

AUTO_START_FILE="/etc/init.d/auto_start_syncrop_cloud"
start()
{
	echo `whoami` >~/whoami.txt
	nohup java -Xms20M -Xmx20M -jar /usr/lib/syncrop/SyncropCloud.jar "$@" >/home/Syncrop/cloud.out&
}

stop()
{
	pid=`pgrep -f 'java.*SyncropCloud'`
	kill $pid
	while ps -p $pid; 
	do 
	sleep 1;
	done;
	
}
version()
{
	java -Xmx15M -jar /usr/lib/syncrop/SyncropCloud.jar "-v"
}
auto-start(){

	if [ "$1" = "--user" ]; then 
		user="$2"
		shift;shift;
	else 
		user=`whoami`
		echo "user not specifed used current user: $user"
	fi
	echo "creating auto start file -->$AUTO_START_FILE "	
	command="#!/bin/sh\ndaemon --user=$user /usr/bin/syncrop-cloud start";
	sudo printf "$command $@\n" >$AUTO_START_FILE
	sudo chmod 744 $AUTO_START_FILE
	sudo update-rc.d auto_start_syncrop_cloud defaults
	
}
remove-auto-start(){
	echo "removing auto start file"
	rm $AUTO_START_FILE
}


shift
case $command in
	start)
		start $@
		;;
	stop)
		stop
		;;
	auto-start)
		auto-start $@
		;;
	restart|reload)
		stop
		start
		;;
	version|"-v"|"--version")
		version
		;;
	*)
		echo $"Usage: $0 {start|stop|restart|reload|status|auto-start}"
	        exit 1
esac

exit 0
